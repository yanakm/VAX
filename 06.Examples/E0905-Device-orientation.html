<!DOCTYPE html>

<html>
	<head>
		<title>E0905: Ориентация на устройство</title>
		<meta charset="utf-8">
		
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
	</head>
	
	<body>
		<h3>alpha = <span id="alpha"></span></h3>
		<h3>beta = <span id="beta"></span></h3>
		<h3>gamma = <span id="gamma"></span></h3>
		<h3>absolute = <span id="absolute"></span></h3>

		<script>
		
				function requestDevicePermissions() {
    			if (typeof DeviceOrientationEvent.requestPermission === 'function' && typeof DeviceMotionEvent.requestPermission === 'function') {

      				 const requestOrientationPermission = () => {
          			 DeviceOrientationEvent.requestPermission().then(permissionState => {
               			if (permissionState === 'granted') {
                   		window.addEventListener('deviceorientation', function(event) {
                        document.getElementById('alpha').innerHTML = event.alpha.toFixed(1);
							document.getElementById('beta').innerHTML = event.beta.toFixed(1);
							document.getElementById('gamma').innerHTML = event.gamma.toFixed(1);
							document.getElementById('absolute').innerHTML = event.absolute.toFixed(1);
                    });
              	 } else {
                  	 	const button = document.createElement('button');
                   		button.innerText = "Enable Orientation";
                    	button.style.position = 'absolute';
						button.style.top = '100%';
						button.style.left = '100%';
						button.style.transform = 'translate(50%, 50%)';
                   		 document.body.appendChild(button);

                    	button.addEventListener('click', () => {
                        requestOrientationPermission();
                        requestMotionPermission();
                        document.body.removeChild(button); // Remove button after requesting permissions
                    });
                }
            }).catch(err => {
                console.error("Error requesting deviceorientation permission:", err);
            });
        };

        const requestOrientationAbsolutePermission = () => {
            DeviceOrientationEvent.requestPermission(true).then(permissionState => {
                if (permissionState === 'granted') {
                    window.addEventListener('deviceorientationabsolute', function(event) {
                         document.getElementById('alpha').innerHTML = event.alpha.toFixed(1);
							document.getElementById('beta').innerHTML = event.beta.toFixed(1);
							document.getElementById('gamma').innerHTML = event.gamma.toFixed(1);
							document.getElementById('absolute').innerHTML = event.absolute.toFixed(1);
                    });
                } else {
                    console.log("deviceorientationabsolute permission denied.");
                }
            }).catch(err => {
                console.error("Error requesting deviceorientationabsolute permission:", err);
            });
        };

        const requestMotionPermission = () => {
            DeviceMotionEvent.requestPermission().then(response => {
                if (response === 'granted') {
                    window.addEventListener('devicemotion', function(event) {
                        _processAccelerometerData(event.acceleration.x, event.acceleration.y, event.acceleration.z);
                        if (event.accelerationIncludingGravity) {
							/*
                            _processAccelerometerDataGravity(
                                event.accelerationIncludingGravity.x,
                                event.accelerationIncludingGravity.y,
                                event.accelerationIncludingGravity.z
                            );*/
                        }
                        if (event.rotationRate) {
							/*
                            _processRotationRateData(
                                event.rotationRate.alpha,
                                event.rotationRate.beta,
                                event.rotationRate.gamma
                            );*/
                        }
                        window.addEventListener('deviceorientation', function(event) {
							
                            //_processGyroscopeData(event.alpha, event.beta, event.gamma, event.absolute);
                        });
                    });
                    console.log("DeviceMotionEvent permission granted.");
                } else {
                     console.error("DeviceMotionEvent permission denied.");
                }
            }).catch(err => {
                console.error("Error requesting DeviceMotionEvent permission:", err);
            });
        };

        requestOrientationPermission();
        const button = document.createElement('button');
        button.innerText = "Enable Orientation";
        button.style.position = 'absolute';
        button.style.top = '100%';
        button.style.left = '100%';
        button.style.transform = 'translate(50%, 50%)';
        document.body.appendChild(button);

        button.addEventListener('click', () => {
            requestOrientationPermission();
            requestMotionPermission();
            document.body.removeChild(button); // Remove button after requesting permissions
        });
    } else {
        // Automatically start listeners on non-iOS 13+ devices
        window.addEventListener('deviceorientation', function(event) {
           document.getElementById('alpha').innerHTML = event.alpha.toFixed(1);
							document.getElementById('beta').innerHTML = event.beta.toFixed(1);
							document.getElementById('gamma').innerHTML = event.gamma.toFixed(1);
							document.getElementById('absolute').innerHTML = event.absolute.toFixed(1);
            console.log("DeviceOrientationEvent listener added automatically.");
        });
        window.addEventListener('devicemotion', function(event) {
            //processAccelerometerData(event.acceleration.x, event.acceleration.y, event.acceleration.z);
            console.log("DeviceMotionEvent listener added automatically.");
        });
    }}
			
		</script>
	</body>
</html>
